<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body></body>
  <script>
    /*
    修改本章前面出现过的 weeklyTemps 对象，使它可以使用一个二维数组来存储每月的有 用数据。
    增加一些方法用以显示月平均数、具体某一周平均数和所有周的平均数。
    */
    function monthTemps() {
      this.dataStore = [
        [
          30,
          40,
          31,
          21,
          12,
          13,
          14,

          15,
          16,
          17,
          18,
          19,
          20,
          30,

          40,
          31,
          21,
          12,
          13,
          14,
          15,

          16,
          17,
          18,
          19,
          30,
          34,
          32,

          31,
          20,
          31,
        ],
        [
          30,
          40,
          31,
          21,
          12,
          13,
          14,

          15,
          16,
          17,
          18,
          19,
          20,
          30,

          40,
          31,
          21,
          12,
          13,
          14,
          15,

          16,
          17,
          18,
          19,
          30,
          34,
          32,

          31,
          20,
          32,
        ],
        [
          30,
          40,
          31,
          21,
          12,
          13,
          14,

          15,
          16,
          17,
          18,
          19,
          20,
          30,

          40,
          31,
          21,
          12,
          13,
          14,
          15,

          16,
          17,
          18,
          19,
          30,
          34,
          32,

          31,
          33,
          34,
        ],
        [
          30,
          40,
          31,
          21,
          12,
          13,
          14,

          15,
          16,
          17,
          18,
          19,
          20,
          30,

          40,
          31,
          21,
          12,
          13,
          14,
          15,

          16,
          17,
          18,
          19,
          30,
          34,
          32,

          31,
          20,
          35,
        ],
      ];
      this.add = add;
      this.averageMonth = averageMonth;
      this.averageOneWeek = averageOneWeek;
      this.averageAllWeek = averageAllWeek;
    }
    // 第几月，这一月的第几天，温度
    function add(month, day, temp) {
      this.dataStore[month][monthDay] = temp;
    }
    // 每个月的平均气温
    function averageMonth() {
      let allAvg = {};
      this.dataStore.forEach((item, index) => {
        const reducer = (accumulator, currentValue) =>
          accumulator + currentValue;

        const total = item.reduce(reducer);

        allAvg[`第${index + 1}月平均气温`] =
          (total / item.length).toFixed(2) - 0;
      });

      return allAvg;
    }

    function averageOneWeek(monthParam, weekParam) {
      const month = monthParam - 1;
      const week = weekParam;
      let allAvg = {};

      const currentMonthData = this.dataStore[month];
      const currentWeekData = currentMonthData.slice((week - 1) * 7, week * 7);

      const totalWeek = currentWeekData.reduce(
        (accumulator, currentValue) => accumulator + currentValue
      );

      return `${monthParam}月第${weekParam}周平均气温:${
        (totalWeek / currentWeekData.length).toFixed(2) - 0
      }`;
    }

    function averageAllWeek() {
      let weekCount = 0;
      let total = 0;
      this.dataStore.forEach((item) => {
        total = item.reduce(
          (accumulator, currentValue) => accumulator + currentValue
        );

        const days = item.length;
        const weeks = (days / 7).toFixed(0) - 0;
        const yuDaysByWeek = days % 7;
        const realWeeks = yuDaysByWeek > 0 ? weeks + 1 : weeks;

        weekCount += realWeeks;
      });

      const res = (total / weekCount).toFixed(2) - 0;

      return `所有周的平均气温:${res}`;
    }

    var newMonth = new monthTemps();

    // 月平均数
    // console.log(newMonth.averageMonth());

    // 具体某一周平均数
    // console.log(newMonth.averageWeek(1, 3));
    // 所有周平均数
    console.log(newMonth.averageAllWeek());
  </script>
</html>
